- project:
    name: 9.x-upgrades

    dist: 'ubuntu'
    version-id: '9.x'
    job-type: 'upgrades'
    base-branch: 'stable/8.0'
    upgrade-branch: 'stable/mitaka'
    base-magnet-link: 'magnet:?xt=urn:btih:4709616bca3e570a951c30b7cf9ffeb2c0359f5c&dn=MirantisOpenStack-8.0.iso&tr=http%3A%2F%2Ftracker01-bud.infra.mirantis.net%3A8080%2Fannounce&tr=http%3A%2F%2Ftracker01-scc.infra.mirantis.net%3A8080%2Fannounce&tr=http%3A%2F%2Ftracker01-msk.infra.mirantis.net%3A8080%2Fannounce&ws=http%3A%2F%2Fvault.infra.mirantis.net%2FMirantisOpenStack-8.0.iso'
    upgrade-magnet-link: 'magnet:?xt=urn:btih:bfec808dd71ff42c5613a3527733d9012bb1fabc&dn=MirantisOpenStack-9.0.iso&tr=http%3A%2F%2Ftracker01-bud.infra.mirantis.net%3A8080%2Fannounce&tr=http%3A%2F%2Ftracker01-scc.infra.mirantis.net%3A8080%2Fannounce&tr=http%3A%2F%2Ftracker01-msk.infra.mirantis.net%3A8080%2Fannounce&ws=http%3A%2F%2Fvault.infra.mirantis.net%2FMirantisOpenStack-9.0.iso'
    base-proposed: 'http://packages.fuel-infra.org/repositories/centos/liberty-centos7/proposed/x86_64'
    upgrade-proposed: 'http://packages.fuel-infra.org/repositories/centos/mitaka-centos7/os/x86_64/'
    node: 'systest'
    timeout: '960'
    venvpath: '/home/jenkins/venv-nailgun-tests-2.9'
    properties: |
      KEYSTONE_PASSWORD=newpass
      SLAVE_NODE_MEMORY=3072
      UPDATE_MASTER=true
      UPGRADE_FUEL_FROM=8.0
      UPGRADE_FUEL_TO=9.1
    weight: '8'
    description: |
      This is product-ci upgrade system test chain (8.0 -> 9.x).

    jobs:
      - '{version-id}.{job-type}.{dist}.{upgrade_testgroup}':
          testgroup: 'upgrade_smoke_backup'
          upgrade_testgroup: 'upgrade_smoke_tests'
      - '{version-id}.{job-type}.{dist}.{upgrade_testgroup}':
          testgroup: 'upgrade_ceph_ha_backup'
          upgrade_testgroup: 'upgrade_ceph_ha_tests'
      - '{version-id}.{job-type}.{dist}.{upgrade_testgroup}':
          testgroup: 'upgrade_plugin_backup'
          upgrade_testgroup: 'upgrade_plugin_tests'
          properties: |
            EXAMPLE_V3_PLUGIN_REMOTE_URL=https://product-ci.infra.mirantis.net/view/All/job/9.0.build-fuel-plugins/lastSuccessfulBuild/artifact/built_plugins/fuel_plugin_example_v3-3.0-3.0.0-1.noarch.rpm
            KEYSTONE_PASSWORD=newpass
            SLAVE_NODE_MEMORY=3072
            UPDATE_MASTER=true
            UPGRADE_FUEL_FROM=8.0
            UPGRADE_FUEL_TO=9.1


- job:
    name: '9.x.upgrades.runner'
    project-type: multijob
    description: 'Run all upgrades tests'
    concurrent: false
    node: 'runner'

    properties:
    - heavy-job:
        weight: 1

    parameters:
    - string:
        name: UBUNTU_MIRROR_ID
        default: 'ubuntu-latest'
        description: |
          'Upstream Ubuntu mirror id: ubuntu-timestamp or ubuntu-latest'
    - string:
        name: CUSTOM_VERSION
        default: ''
        description: 'Label for TestPlan name (any string). It is used by TestRail reporter. Example: "MU-1".'

    wrappers:
    - timeout:
        fail: true
        timeout: 1200

    builders:
    - multijob:
        name: 'Run upgrade tests'
        condition: COMPLETED
        projects:
          - name: '9.x.upgrades.ubuntu.upgrade_smoke_tests'
            current-parameters: true
            kill-phase-on: NEVER
          - name: '9.x.upgrades.ubuntu.upgrade_ceph_ha_tests'
            current-parameters: true
            kill-phase-on: NEVER
          - name: '9.x.upgrades.ubuntu.upgrade_plugin_tests'
            current-parameters: true
            kill-phase-on: NEVER

    publishers:
    - description-setter:
        regexp: "'Description string: (.*)'"
    - email-default:
        mail-to: 'ci+alert@mirantis.com'
