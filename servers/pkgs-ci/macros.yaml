########################################################################
# Section: Wrappers
########################################################################

- wrapper:
    name: build-timeout
    wrappers:
      - timeout:
          timeout: '{timeout}'
          timeout-var: 'BUILD_TIMEOUT'
          fail: True

########################################################################
# Section: Triggers
########################################################################
########################################################################
# Section: SCM
########################################################################

- scm:
    name: fuel-infra
    scm:
      - git:
          url: 'ssh://{scm-user}@review.fuel-infra.org:29418/{scm-repo}.git'
          basedir: '{scm-basedir}'
          credentials-id: '{scm-credentials-id}'
          skip-tag: True
          branches:
            - '{scm-branch}'
          browser: gitweb
          browser-url: https://review.fuel-infra.org/gitweb?p={scm-repo}.git

- scm:
    name: fuel-infra-src
    scm:
      - git:
          url: 'ssh://{scm-user}@review.fuel-infra.org:29418/${{SRC_PROJECT}}.git'
          basedir: 'wrk-build/${{PACKAGENAME}}-src'
          credentials-id: '{scm-credentials-id}'
          skip-tag: True
          branches:
            - ${{SOURCE_BRANCH}}
          refspec: ${{SOURCE_REFSPEC}}
          browser: gitweb
          browser-url: https://review.fuel-infra.org/gitweb?p=${{SRC_PROJECT}}.git
          wipe-workspace: False

- scm:
    name: fuel-infra-spec
    scm:
      - git:
          url: 'ssh://{scm-user}@review.fuel-infra.org:29418/${{SPEC_PROJECT}}.git'
          basedir: 'wrk-build/${{PACKAGENAME}}-spec'
          credentials-id: '{scm-credentials-id}'
          skip-tag: True
          branches:
            - ${{SPEC_BRANCH}}
          refspec: ${{SPEC_REFSPEC}}
          browser: gitweb
          browser-url: https://review.fuel-infra.org/gitweb?p=${{SPEC_PROJECT}}.git
          wipe-workspace: False

- scm:
    name: upstream
    scm:
      - git:
          url: 'https://git.openstack.org/{fuel-namespace}/{repo}.git'
          branches:
            - 'origin/{branch}'
          basedir: '{repo}'
          wipe-workspace: false

- scm:
    name: zuul
    scm:
      - git:
          url: '${ZUUL_URL}/${ZUUL_PROJECT}'
          branches:
            - '${ZUUL_BRANCH}'
          refspec: '${ZUUL_REF}'
          wipe-workspace: False

- scm:
    name: perestroika
    scm:
      - git:
          url: 'https://git.openstack.org/openstack/fuel-mirror.git'
          branches:
            - '{branch}'
          basedir: 'fuel-mirror'

########################################################################
# Section: Parameters
########################################################################

########################################################################
# Section: Publushers
########################################################################
- publisher:
    name: email-alert-on-merge
    publishers:
      - email-ext:
          body: $DEFAULT_CONTENT
          send-to:
            - recipients
          recipients: 'ci+publishing-alert@mirantis.com, fuel-build+publishing-alert@mirantis.com'
          subject: '[Packaging-ci][$PROJECT_NAME] Package build/publish on merge failed - # $BUILD_NUMBER'
          presend-script:
            !include-raw 'email_ext_groovy.inc'
          failure: true
