########################################################################
# Section: Builders
########################################################################

- builder:
    name: systest
    builders:
      - shell:
          !include-raw builders/system_test.sh

########################################################################
# Section: Wrappers
########################################################################

- wrapper:
    name: build-timeout
    wrappers:
      - timeout:
          timeout: '{timeout}'
          timeout-var: 'BUILD_TIMEOUT'
          fail: True

- wrapper:
    name: jenkins
    wrappers:
      - ssh-agent-credentials:
          users:
            - '0772133d-e02e-4385-9304-e87e7f830b4e'

- wrapper:
    name: gerrit-creds
    wrappers:
      - ssh-agent-credentials:
          users:
            - 'a2a7e956-9dc7-4eb1-b396-ba981c2a8c81'
            - '92ba60e8-9c4d-4977-b161-8621e39c0116'
            - '04ec6ed9-b3c4-4a56-bcc8-becc889f19cb'

- wrapper:
    name: install-vm-creds
    wrappers:
      - ssh-agent-credentials:
          users:
            - 'a2a7e956-9dc7-4eb1-b396-ba981c2a8c81'
            - 'd2f87345-ff0f-4470-bb25-9c9d944f81d1'
            - '7a9284db-cc0e-46e1-992d-7c5f163f0678'

########################################################################
# Section: Triggers
########################################################################
########################################################################
# Section: SCM
########################################################################

- scm:
    name: fuel-infra
    scm:
      - git:
          url: 'ssh://{scm-user}@review.fuel-infra.org:29418/{scm-repo}.git'
          basedir: '{scm-basedir}'
          credentials-id: '{scm-credentials-id}'
          skip-tag: True
          branches:
            - '{scm-branch}'
          browser: gitweb
          browser-url: https://review.fuel-infra.org/gitweb?p={scm-repo}.git

- scm:
    name: fuel-infra-src
    scm:
      - git:
          url: 'ssh://{scm-user}@review.fuel-infra.org:29418/${{SRC_PROJECT}}.git'
          basedir: 'wrk-build/${{PACKAGENAME}}-src'
          credentials-id: '{scm-credentials-id}'
          skip-tag: True
          branches:
            - ${{SOURCE_BRANCH}}
          refspec: ${{SOURCE_REFSPEC}}
          browser: gitweb
          browser-url: https://review.fuel-infra.org/gitweb?p=${{SRC_PROJECT}}.git
          wipe-workspace: False

- scm:
    name: fuel-infra-spec
    scm:
      - git:
          url: 'ssh://{scm-user}@review.fuel-infra.org:29418/${{SPEC_PROJECT}}.git'
          basedir: 'wrk-build/${{PACKAGENAME}}-spec'
          credentials-id: '{scm-credentials-id}'
          skip-tag: True
          branches:
            - ${{SPEC_BRANCH}}
          refspec: ${{SPEC_REFSPEC}}
          browser: gitweb
          browser-url: https://review.fuel-infra.org/gitweb?p=${{SPEC_PROJECT}}.git
          wipe-workspace: False

- scm:
    name: upstream
    scm:
      - git:
          url: 'https://git.openstack.org/{fuel-namespace}/{repo}.git'
          branches:
            - 'origin/{branch}'
          basedir: '{repo}'
          wipe-workspace: false

- scm:
    name: zuul
    scm:
      - git:
          url: '${ZUUL_URL}/${ZUUL_PROJECT}'
          branches:
            - '${ZUUL_BRANCH}'
          refspec: '${ZUUL_REF}'
          wipe-workspace: False

########################################################################
# Section: Parameters
########################################################################

########################################################################
# Section: Publushers
########################################################################
- publisher:
    name: email-alert-on-merge
    publishers:
      - email-ext:
          body: $DEFAULT_CONTENT
          send-to:
            - recipients
          recipients: 'skulanov@mirantis.net'
          subject: '[Packaging-ci][$PROJECT_NAME] Fuel package build on merge failed - # $BUILD_NUMBER'
          presend-script:
            !include-raw 'email_ext_groovy.inc'
          failure: true
