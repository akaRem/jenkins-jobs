#
# Project definitions
#

- common_template: &common_template
    name: ''

    project-name: 'mos'

    master-mos-version: '9.0'

    main_ubuntu_release: 'trusty'

    repo-host: 'perestroika-repo-tst.infra.mirantis.net'

    product_jenkins_url: 'https://product-ci.infra.mirantis.net/'

    base-path: 'base/'
    updates-path: 'updates/'
    security-path: 'security/'

    cr-path-prefix: 'review/'
    rel-path-prefix: 'mos-repos/'

    repo-base-path: '/home/jenkins/pubrepos'

    fuel-namespace: 'openstack'

    install-scm-repo: 'infra/ci-test-request'
    install-scm-branch: 'origin/master'

    spec-path-prefix: ''
    spec-path-suffix: '-build'
    spec-project-prefix: ''
    spec-project-suffix: '-build'

    # Enables paching workflow
    is_updates: 'false'

    # Job slave nodes
    build-node: 'new-builder'
    publish-node: 'new-publisher'
    install-node: 'install-node'
    systest-node: 'systest'

- gerrit_params: &gerrit_params
    name: ''
    gerrit-host: 'review.fuel-infra.org'
    gerrit-user: 'openstack-ci-jenkins'
    gerrit-port: '29418'


- project:
    <<: *common_template
    <<: *gerrit_params
    name: 'pkg-mos-rhel'
    os: 'rhel'
    openstack_release: 'ubuntu'
    mos_version: '8.0'
    fuel-main-branch: 'stable/8.0'
    fuel-qa-branch: 'stable/8.0'
    distro: 'centos7'
    pkg_type: 'rpm'
    spec_path_prefix: '/centos7'
    deb-dist-name: mos8.0
    rpm-dist-name: mos8.0-centos7-fuel
    jobs:
      - '{mos_version}-pkg-systest-{os}':
          main-rpm-dist-name: 'mos8.0-centos7-fuel'


- project:
    <<: *common_template
    <<: *gerrit_params
    name: 'pkg-mos-master-centos'
    os: 'centos'
    openstack_release: 'ubuntu'
    mos_version: master
    fuel-main-branch: 'master'
    fuel-qa-branch: 'master'
    perestroika-branch: 'master'
    distro: 'centos7'
    pkg_type: 'rpm'
    spec_path_prefix: '/centos7'
    deb-dist-name: mos-master
    rpm-dist-name: mos-master-centos7
    jobs:
      - '{mos_version}-pkg-pipeline-{os}'
      - '{mos_version}-pkg-publish-{os}'
      - '{mos_version}-pkg-install-{os}'
      - '{mos_version}-pkg-repotest-{os}'
      - '{mos_version}-pkg-systest-{os}':
          main-rpm-dist-name: 'mos-master-centos7'
      - '{mos_version}-pkg-massrebuild-starter-{os}'
      - '{mos_version}-pkg-massrebuild-{os}'

- project:
    <<: *common_template
    <<: *gerrit_params
    name: 'pkg-mos-8.0-centos'
    os: 'centos'
    mos_version: '8.0'
    fuel-main-branch: 'stable/8.0'
    fuel-qa-branch: 'stable/8.0'
    perestroika-branch: 'stable/8.0'
    distro: 'centos7'
    pkg_type: 'rpm'
    spec_path_prefix: '/centos7'
    is_updates: 'true'
    openstack_release: 'ubuntu'
    deb-dist-name: mos8.0
    rpm-dist-name: mos8.0-centos7-fuel
    jobs:
      - '{mos_version}-pkg-pipeline-{os}'
      - '{mos_version}-pkg-publish-{os}'
      - '{mos_version}-pkg-install-{os}'
      - '{mos_version}-pkg-repotest-{os}'
      - '{mos_version}-pkg-systest-{os}':
          main-rpm-dist-name: 'mos8.0-centos7-fuel'
      - '{mos_version}-pkg-massrebuild-starter-{os}'
      - '{mos_version}-pkg-massrebuild-{os}'

- project:
    <<: *common_template
    <<: *gerrit_params
    name: 'pkg-mos-9.0-centos'
    os: 'centos'
    mos_version: '9.0'
    fuel-main-branch: 'master'
    fuel-qa-branch: 'master'
    perestroika-branch: 'master'
    distro: 'centos7'
    pkg_type: 'rpm'
    spec_path_prefix: '/centos7'
    openstack_release: 'ubuntu'
    deb-dist-name: mos9.0
    rpm-dist-name: mos9.0-centos7
    jobs:
      - '{mos_version}-pkg-pipeline-{os}'
      - '{mos_version}-pkg-publish-{os}'
      - '{mos_version}-pkg-install-{os}'
      - '{mos_version}-pkg-repotest-{os}'
      - '{mos_version}-pkg-systest-{os}':
          main-rpm-dist-name: mos9.0-centos7
      - '{mos_version}-pkg-massrebuild-starter-{os}'
      - '{mos_version}-pkg-massrebuild-{os}'

- project:
    <<: *common_template
    <<: *gerrit_params
    name: 'pkg-mos-master-debian'
    os: 'debian'
    mos_version: 'master'
    fuel-main-branch: 'master'
    fuel-qa-branch: 'master'
    perestroika-branch: 'master'
    distro: 'jessie'
    pkg_type: 'deb'
    spec_path_prefix: '/jessie'
    deb-dist-name: mos-master
    rpm-dist-name: mos-master-jessie
    openstack_release: 'ubuntu'
    jobs:
      - '{mos_version}-pkg-pipeline-{os}'
      - '{mos_version}-pkg-publish-{os}'
      - '{mos_version}-pkg-install-{os}'
      - '{mos_version}-pkg-repotest-{os}'
      - '{mos_version}-pkg-systest-{os}':
          main-rpm-dist-name: 'mos-master-centos7'
          rpm-dist-name: mos-master-centos7
      - '{mos_version}-pkg-massrebuild-starter-{os}'
      - '{mos_version}-pkg-massrebuild-{os}'

- project:
    <<: *common_template
    <<: *gerrit_params
    name: 'pkg-mos-8.0-debian'
    os: 'debian'
    mos_version: '8.0'
    fuel-main-branch: 'stable/8.0'
    fuel-qa-branch: 'stable/8.0'
    perestroika-branch: 'stable/8.0'
    distro: 'jessie'
    pkg_type: 'deb'
    spec_path_prefix: '/jessie'
    deb-dist-name: mos8.0
    rpm-dist-name: mos8.0-jessie
    openstack_release: 'ubuntu'
    jobs:
      - '{mos_version}-pkg-pipeline-{os}'
      - '{mos_version}-pkg-publish-{os}'
      - '{mos_version}-pkg-install-{os}'
      - '{mos_version}-pkg-repotest-{os}'
      - '{mos_version}-pkg-systest-{os}':
          main-rpm-dist-name: 'mos8.0-centos7'
          rpm-dist-name: mos8.0-centos7
      - '{mos_version}-pkg-massrebuild-starter-{os}'
      - '{mos_version}-pkg-massrebuild-{os}'


- project:
    <<: *common_template
    <<: *gerrit_params
    name: 'pkg-mos-9.0-debian'
    os: 'debian'
    mos_version: '9.0'
    fuel-main-branch: 'master'
    fuel-qa-branch: 'master'
    perestroika-branch: 'master'
    distro: 'jessie'
    pkg_type: 'deb'
    spec_path_prefix: '/jessie'
    deb-dist-name: mos9.0
    rpm-dist-name: mos9.0-jessie
    openstack_release: 'ubuntu'
    jobs:
      - '{mos_version}-pkg-pipeline-{os}'
      - '{mos_version}-pkg-publish-{os}'
      - '{mos_version}-pkg-install-{os}'
      - '{mos_version}-pkg-repotest-{os}'
      - '{mos_version}-pkg-systest-{os}':
          main-rpm-dist-name: 'mos9.0-centos7'
          rpm-dist-name: mos9.0-centos7
      - '{mos_version}-pkg-massrebuild-starter-{os}'
      - '{mos_version}-pkg-massrebuild-{os}'

- project:
    <<: *common_template
    <<: *gerrit_params
    name: 'pkg-mos-master-ubuntu'
    os: 'ubuntu'
    mos_version: 'master'
    fuel-main-branch: 'master'
    fuel-qa-branch: 'master'
    perestroika-branch: 'master'
    distro: 'trusty'
    pkg_type: 'deb'
    spec_path_prefix: '/trusty'
    openstack_release: 'ubuntu'
    deb-dist-name: mos-master
    rpm-dist-name: mos-master-trusty
    jobs:
      - '{mos_version}-pkg-pipeline-{os}'
      - '{mos_version}-pkg-publish-{os}'
      - '{mos_version}-pkg-install-{os}'
      - '{mos_version}-pkg-repotest-{os}'
      - '{mos_version}-pkg-systest-{os}':
          main-rpm-dist-name: 'mos-master-centos7'
          rpm-dist-name: mos-master-centos7
      - '{mos_version}-pkg-massrebuild-starter-{os}'
      - '{mos_version}-pkg-massrebuild-{os}'

- project:
    <<: *common_template
    <<: *gerrit_params
    name: 'pkg-mos-8.0-ubuntu'
    os: 'ubuntu'
    mos_version: '8.0'
    fuel-main-branch: 'stable/8.0'
    fuel-qa-branch: 'stable/8.0'
    perestroika-branch: 'stable/8.0'
    distro: 'trusty'
    pkg_type: 'deb'
    spec_path_prefix: '/trusty'
    is_updates: 'true'
    openstack_release: 'ubuntu'
    deb-dist-name: mos8.0
    rpm-dist-name: mos8.0-trusty
    jobs:
      - '{mos_version}-pkg-pipeline-{os}'
      - '{mos_version}-pkg-publish-{os}'
      - '{mos_version}-pkg-install-{os}'
      - '{mos_version}-pkg-repotest-{os}'
      - '{mos_version}-pkg-systest-{os}':
          main-rpm-dist-name: 'mos8.0-centos7'
          rpm-dist-name: mos8.0-centos7
      - '{mos_version}-pkg-massrebuild-starter-{os}'
      - '{mos_version}-pkg-massrebuild-{os}'

- project:
    <<: *common_template
    <<: *gerrit_params
    name: 'pkg-mos-9.0-ubuntu'
    os: 'ubuntu'
    mos_version: '9.0'
    fuel-main-branch: 'master'
    fuel-qa-branch: 'master'
    perestroika-branch: 'master'
    distro: 'trusty'
    pkg_type: 'deb'
    spec_path_prefix: '/trusty'
    openstack_release: 'ubuntu'
    deb-dist-name: mos9.0
    rpm-dist-name: mos9.0-trusty
    jobs:
      - '{mos_version}-pkg-pipeline-{os}'
      - '{mos_version}-pkg-publish-{os}'
      - '{mos_version}-pkg-install-{os}'
      - '{mos_version}-pkg-repotest-{os}'
      - '{mos_version}-pkg-systest-{os}':
          main-rpm-dist-name: 'mos9.0-centos7'
          rpm-dist-name: mos9.0-centos7
      - '{mos_version}-pkg-massrebuild-starter-{os}'
      - '{mos_version}-pkg-massrebuild-{os}'

- project:
    <<: *gerrit_params
    <<: *common_template
    name: 'gate'
    mos_version:
      - 'master'
      - '8.0'
      - '9.0'
    jobs:
      - '{mos_version}-pkg-gate'

- project:
    name: 'maintenace'
    jobs:
      - 'maintain.starter'
      - 'maintain.worker'
    maintain-node: 'new-builder'
    is-disabled: ''
    mailto: 'fuel-build+ci-packaging@mirantis.com'

- project:
    name: 'zuul'
    jobs:
      - 'zuul-maintainer'
    is-disabled: ''
    mailto: 'fuel-build+ci-packaging@mirantis.com'
    scm-repo: 'fuel-infra/zuul-layouts'
    scm-branch: 'master'
    scm-basedir: ''
    ops-code-prj: 'fuel-infra/**'
    ops-spec-prj: 'fuel-infra/**'
    ops-branch: 'master'
    build-node: 'new-builder'

- project:
    name: 'sync'
    jobs:
      - 'sync_debian_specs'
      - 'sync_debian_specs_force'
    scm-repo: 'infra/mirrors'
    scm-branch: 'master'
    scm-basedir: ''
    sync-node: 'sync-deb-spec'

- project:
    name: 'devops.env'
    version-id:
      - 'master'
      - '8.0'
      - '9.0'
    jobs:
      - 'devops.{version-id}.env'

- project:
    <<: *common_template
    name: 'resync-repos-to-mirrors'
    trsync-node: 'mirror-sync'
    trsync-scm-repo: 'infra/trsync'
    trsync-scm-branch: 'master'
    trsync-scm-basedir: 'trsync'
    mailto: 'fuel-build+ci-packaging@mirantis.com'
    mos_version:
        # fixme: remove this job after 9.0 GA
        - '9.0':
            rpm-repo-name: 'mos{mos_version}-centos7'
        - master:
            rpm-repo-name: 'mos-{mos_version}-centos7'
    jobs:
        - '{mos_version}.resync-repos-to-mirrors'

- project:
    <<: *common_template
    name: 'universal build and publish jobs'
    jobs:
      - 'packages.update.centos'
      - 'packages.build.centos'
      - 'packages.publish.centos'

      - 'packages.update.ubuntu'
      - 'packages.build.ubuntu'
      - 'packages.publish.ubuntu'

- project:
    name: 'master.packages.update-trunk.centos openstack projects'

    project_version: master
    is_openstack: "true"
    is_fuel: "false"

    # rebuild all in 2 days, spreaded evenly
    timed: 'H H H/2 * *'

    project_name:

      # oslo is not gated in upstream, so it's
      # disabled because it could break all the pipelines

      #- 'oslo'
      #- 'oslo.cache'
      #- 'oslo.concurrency'
      #- 'oslo.config'
      #- 'oslo.context'
      #- 'oslo.db'
      #- 'oslo.i18n'
      #- 'oslo-incubator'
      #- 'oslo.log'
      #- 'oslo.messaging'
      #- 'oslo.middleware'
      #- 'oslo.policy'
      #- 'oslo.reports'
      #- 'oslo.rootwrap'
      #- 'oslo.serialization'
      #- 'oslo.service'
      #- 'oslosphinx'
      #- 'oslotest'
      #- 'oslo.utils'
      #- 'oslo.version'
      #- 'oslo.versionedobjects'
      #- 'oslo.vmware'

      # keystoneauth

      - 'keystoneauth'

      # os-*

      - 'os-apply-config'
      - 'os-brick'
      - 'os-client-config'
      - 'os-cloud-config'
      - 'os-collect-config'
      - 'os-net-config'
      - 'os-refresh-config'
      - 'os-testr'
      - 'os-win'

      # python-clients

      - 'python-aodhclient'
      - 'python-barbicanclient'
      - 'python-brick-cinderclient-ext'
      - 'python-ceilometerclient'
      - 'python-cinderclient'
      - 'python-congressclient'
      - 'python-designateclient'
      - 'python-glanceclient'
      - 'python-gnocchiclient'
      - 'python-heatclient'
      - 'python-ironicclient'
      - 'python-keystoneclient'
      - 'python-magnumclient'
      - 'python-manilaclient'
      - 'python-marketplaceclient'
      - 'python-mistralclient'
      - 'python-muranoclient'
      - 'python-neutronclient'
      - 'python-novaclient'
      - 'python-openstackclient'
      - 'python-saharaclient'
      - 'python-senlinclient'
      - 'python-swiftclient'
      - 'python-troveclient'
      - 'python-zaqarclient'

      - 'keystone'

      - 'bareon'

      # todo: add more projects

    jobs:
      - '{project_version}.packages.update-trunk.centos.{project_name}'
      - '{project_version}.packages.update-trunk.ubuntu.{project_name}'

- project:
    name: 'master.packages.update-trunk.centos fuel projects'

    project_version: master
    is_openstack: "false"
    is_fuel: "true"

    # rebuild all every day, spreaded evenly
    timed: 'H H H * *'

    project_name:
      # FIXME: add missing packages
      - fuel-library
      - shotgun

    jobs:
      - '{project_version}.packages.update-trunk.centos.{project_name}'
      - '{project_version}.packages.update-trunk.ubuntu.{project_name}'
