- job-template:
    name: '{mos_version}-pkg-massrebuild-{os}'
    concurrent: true
    description: |
        This job is worker for mass-rebuild case.<br>
        It builds a package and then publishes it by triggerring publisher job<br>
        with enabled downgrade feature.<br>
    node: '{build-node}-{mos_version}'
    wrappers:
      - timeout:
          timeout: 300
      - timestamps
      - ansicolor
      - ssh-agent-credentials:
          users:
            - '{ssh-creds-openstack-ci-jenkins}'
            - '{ssh-creds-unknown-1}'
            - '{ssh-creds-unknown-2}'
    scm:
      - perestroika:
          branch: '{perestroika-branch}'
    properties:
      - inject:
          properties-content: |
            PKG_TYPE={pkg_type}
    parameters:
      - string:
          name: PACKAGENAME
          default: ''
    builders:
      - shell:
          !include-raw builders/massrebuild.sh.template
      - trigger-builds:
          - project: '{mos_version}-pkg-publish-{os}'
            current-parameters: true
            property-file: buildresult.params
            block: true
    publishers:
      - archive:
          artifacts: buildresult.params
          allow-empty: true
