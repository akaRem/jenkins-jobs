- job-template:
    name: '{mos_version}-pkg-systest-{os}'
    concurrent: true
    logrotate:
      artifactDaysToKeep: 90
      daysToKeep: 90
    properties:
      - heavy-job:
          weight: 8
    parameters:
      - string:
          name: MAGNET_LINK
      - string:
          name: TEST_GROUP
          default: '{test_group}'
      - string:
          name: OPENSTACK_RELEASE
          default: '{openstack_release}'
      - string:
          name: ENV_PREFIX
          default: '{mos_version}-pkg-systest-{os}'
          description: Define env prefix name. This parameter should not be changed
      - string:
          name: NEUTRON_ENABLE
          default: 'true'
      - string:
          name: UBUNTU_MIRROR_ID
          default: latest
          description: |
            'latest' - latest available; 'latest-stable' - mirror from successful run of 7.0.test_all job; 'ubuntu-2015-01-01-030500'
      - string:
          name: MIRROR_UBUNTU
          default:
          description: |
            If empty, it will be set automatically based on UBUNTU_MIRROR_ID value.
            <p>
            deb http://../ubuntu trusty main universe multiverse|deb http://../ubuntu trusty-updates main universe multiverse|deb http://../ubuntu trusty-security main universe multiverse|deb http://../ubuntu trusty-proposed main universe multiverse
      - string:
          name: EXTRA_DEB_REPOS
          default: ''
          description: 'deb http://... trusty main'
      - string:
          name: EXTRA_DEB_REPOS_PRIORITY
          default: '1052'
      - string:
          name: PRODUCT_JENKINS_URL
          default: '{product_jenkins_url}'
      - string:
          name: ISO_JOB_NAME
          default: '{mos_version}.test_all'
    scm:
      - stackforge:
          branch: 'master'
          repo: fuel-main
      - stackforge:
          branch: 'master'
          repo: fuel-qa
      - fuel-infra:
          scm-user: '{scm-user}'
          scm-repo: '{scm-ci-status-client-repo}'
          scm-basedir: '{scm-ci-status-client-basedir}'
          scm-credentials-id: '{scm-credentials-id}'
          scm-branch: '{scm-ci-status-client-branch}'
    properties:
      - inject:
          properties-content: |
            PKG_TYPE={pkg_type}
    builders:
      - systest-{os}
      - shell: |
          #!/bin/bash -xe
          export DIST="${{DIST:-{distro}}}"
          ci-status-client/ci-status-report.sh start
    wrappers:
      - gerrit-creds
      - timeout:
          fail: true
          timeout: 210
      - timestamps
      - ansicolor
    publishers:
      - post-tasks:
         - matches:
            - log-text: Building
              operator: AND
           script: |
             #!/bin/bash -xe
             export DIST="${{DIST:-{distro}}}"
             ci-status-client/ci-status-report.sh stop
      - archive:
          allow-empty: true
          artifacts: '**/nosetests.xml,logs/*, ci_status_params'
          latest-only: false
      - logparser:
          parse-rules: '/var/lib/jenkins/fuellib.parser'
          unstable-on-warning: false
          fail-on-error: false
      - junit:
          keep-long-stdio: false
          results: '**/nosetests.xml'

    node: '{systest-node}'
