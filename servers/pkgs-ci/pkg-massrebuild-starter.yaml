- job-template:
    name: '{mos_version}-pkg-massrebuild-starter-{os}'
    concurrent: false
    node: '{systest-node}'
    parameters:
      - text:
          name: PACKAGE_LIST
          default:
            !include-raw-escape openstack-projects.yaml.inc
          description: |
            List of openstack projects in yaml-like format: "- package-name"

    builders:
      - shell: |
          #!/bin/bash
          rm -f properties-*
          for x in ${{PACKAGE_LIST}}
          do
              package=$(echo "${{x:2}}" | awk -F @ '{{print $1}}')
              propfile="properties-$package"
              echo "PACKAGENAME=$package" > "$propfile"
          done

      - trigger-builds:
          - project: '{mos_version}-pkg-massrebuild-{os}'
            block: true
            parameter-factories:
              - factory: filebuild
                file-pattern: properties-*
                no-files-found-action: FAIL
            block: true
            block-thresholds:
              build-step-failure-threshold: never
