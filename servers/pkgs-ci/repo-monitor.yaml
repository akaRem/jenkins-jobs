- job-template:
    name: '{version-id}-deb-repo-monitor'
    project-type: freestyle
    description: "Repo monitor for {version-id} ubuntu repository"
    node: '{build-node}'
    triggers:
      - timed: "H 10 * * *"
    builders:
      - inject:
          properties-content: |
            REPO={version-id}
            TEMP_DIR=${{WORKSPACE}}/tmp
            SRC_DIR=${{WORKSPACE}}/src
            KNOWN_ISSUES_LIST=${{WORKSPACE}}/exceptions/deb/{version-id}_known_issues.txt
            PACKAGES_REPO_HOST=perestroika-repo-tst.infra.mirantis.net/mos-repos
            INCLUDE_REPOS={include-repo}
            GERRIT_HOST=review.fuel-infra.org
            GERRIT_PORT=29418
            GERRIT_USER={scm-user}
            GERRIT_QUERY_FORMAT=TEXT
      - shell: |
          #!/bin/bash
          set -ex
          "${{WORKSPACE}}/deb-repo-monitor.sh"
    publishers:
      - archive:
          allow-empty: 'false'
          artifacts: '**/report.txt'
    scm:
      - fuel-infra:
          scm-user: '{scm-user}'
          scm-repo: '{scm-repo}'
          scm-basedir: ''
          scm-credentials-id: '{scm-credentials-id}'
          scm-branch: 'master'
    wrappers:
       - gerrit-creds

- job-template:
    name: '{version-id}-rpm-repo-monitor'
    project-type: freestyle
    description: "Repo monitor job for {version-id} {distro} repository"
    node: '{build-node}'
    triggers:
      - timed: "H 10 * * *"
    builders:
      - inject:
          properties-content: |
            DISTRO={distro}
            REPO=mos{repo_name_sep}{version-id}-{distro}{repo_suff_rpm}
            TEMP_DIR=${{WORKSPACE}}/tmp
            SRC_DIR=${{WORKSPACE}}/src
            KNOWN_ISSUES_LIST=${{WORKSPACE}}/exceptions/rpm/mos{repo_name_sep}{version-id}-{distro}{repo_suff_rpm}_known_issues.txt
            PACKAGES_REPO_HOST=perestroika-repo-tst.infra.mirantis.net/mos-repos
            INCLUDE_REPOS={include-repo}
            GERRIT_HOST=review.fuel-infra.org
            GERRIT_PORT=29418
            GERRIT_USER={scm-user}
            GERRIT_QUERY_FORMAT=TEXT
      - shell: |
          #!/bin/bash
          set -ex
          "${{WORKSPACE}}/rpm-repo-monitor.sh"
    publishers:
      - archive:
          allow-empty: 'false'
          artifacts: '**/report.txt'
    scm:
      - fuel-infra:
          scm-user: '{scm-user}'
          scm-repo: '{scm-repo}'
          scm-basedir: ''
          scm-credentials-id: '{scm-credentials-id}'
          scm-branch: 'master'
    wrappers:
       - gerrit-creds

- project:
    name: 'repo-monitors'
    repo_name_sep: ''
    repo_suff_rpm: ''
    version-id:
      - '8.0':
          repo_suff_rpm: '-fuel'
      - '9.0'
      - 'master':
          repo_name_sep: '-'
    scm-user: 'openstack-ci-jenkins'
    scm-repo: 'fuel-infra/repo-monitor'
    scm-credentials-id: 'a2a7e956-9dc7-4eb1-b396-ba981c2a8c81'
    build-node: 'new-builder'
    jobs:
      - '{version-id}-deb-repo-monitor':
         include-repo: 'main proposed'
      - '{version-id}-rpm-repo-monitor':
         distro: 'centos7'
         include-repo: 'os proposed'

