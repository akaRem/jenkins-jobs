- job-template:
    name: '{name}'
    builders:
      - shell:
          !include-raw-escape builders/docker_run.sh
      - inject:
          properties-content: '{properties}'
    description: '{description}'
    logrotate:
      daysToKeep: '{days}'
      numToKeep: '{num}'
    properties:
      - heavy-job:
          weight: 1
    parameters:
      - label:
         name: LABEL_SERVER
         default: '{label_server}'
         description: 'Label of the slave to run the script'
      - string:
         name: DOCKER_IMAGE
         default: '{docker_image}'
         description: 'Name of the docker image to run'
      - string:
         name: MODE
         default: '{mode}'
         description: 'Mode to run script'
      - string:
         name: SCRIPT_PATH
         default: '{script_path}'
         description: 'Name of a script to execute'
      - string:
         name: REPOSITORY
         default: '{repository}'
         description: 'Link to a repository with scripts'
      - string:
         name: VOLUMES
         default: '{volumes}'
         description: 'Volumes to mount into container'
    publishers:
      - email:
          recipients: '{recipients}'
    scm:
      - git:
         url: '{repository}'
         credentials-id: '{credentials}'
         branches:
            - origin/master
    triggers:
      - timed: '{trigger}'

- project:
    name: 'hello-world'
    credentials: '87e8f7c8-9d04-4ffa-bd9c-9ef88acffec0'
    days: 90
    description: 'The job to run hello-world.py script'
    docker_image: 'python-jenkins-14-04'
    label_server: 'custom-scripts'
    mode: ''
    num: 100
    properties: ''
    recipients: 'devops+alert@mirantis.com'
    repository: 'ssh://custom-scripts-ci@review.fuel-infra.org:29418/tools/custom-scripts'
    script_path: 'hello-world/hello-world.py'
    trigger: 'H */1 * * *'
    volumes: '-v /etc/custom_scripts/foo_bar.config:/etc/custom_scripts/foo_bar.config'

    jobs:
      - '{name}'

- project:
    name: 'requests-abandon'
    credentials: '87e8f7c8-9d04-4ffa-bd9c-9ef88acffec0'
    days: 90
    description: 'The job to run the script which abandon old request on review.openstack.org'
    docker_image: 'python-jenkins-14-04'
    label_server: 'custom-scripts'
    mode: ''
    num: 100
    properties: ''
    recipients: 'devops+alert@mirantis.com'
    repository: 'ssh://custom-scripts-ci@review.fuel-infra.org:29418/tools/custom-scripts'
    script_path: 'requests-abandon/abandon_old_reviews.sh'
    trigger: 'H 1 * * 2'
    volumes: '-v /etc/custom_scripts/id_rsa:/etc/custom_scripts/id_rsa -v /home/jenkins/.ssh/known_hosts:/root/.ssh/known_hosts'

    jobs:
      - '{name}'

- project:
    name: 'lp-assigner'
    credentials: '87e8f7c8-9d04-4ffa-bd9c-9ef88acffec0'
    days: 90
    description: 'The job to run the script to assign bugs on Launchpad'
    docker_image: 'python-jenkins-14-04'
    label_server: 'custom-scripts'
    mode: '--assign'
    num: 100
    properties: |
      BASE_URL = https://api.launchpad.net/devel/
      DEBUG = 0
    recipients: 'devops+alert@mirantis.com'
    repository: 'ssh://custom-scripts-ci@review.fuel-infra.org:29418/tools/custom-scripts'
    script_path: 'lp-assigner/lpassigner.py'
    trigger: ''
    volumes: '-v /etc/custom_scripts/lpassigner.conf:/etc/custom_scripts/lpassigner.conf -v /etc/custom_scripts/lpassigner_creds.conf:/etc/custom_scripts/lpassigner_creds.conf -v /home/jenkins/.ssh/known_hosts:/root/.ssh/known_hosts'

    jobs:
      - '{name}'

- project:
    name: 'lp_release_migrator'
    credentials: '87e8f7c8-9d04-4ffa-bd9c-9ef88acffec0'
    days: 1
    description: 'The job to migrate Launchpad bugs between milestones after releases.'
    docker_image: 'python-jenkins-14-04'
    label_server: 'custom-scripts'
    mode: '--execute'
    num: 100
    properties: |
      LP_RELEASE_PROJECTS = fuel, mos
      LP_RELEASE_OLD_MILESTONE_NAMES = 7.0
      LP_RELEASE_NEW_MILESTONE_NAME = 8.0
      LP_RELEASE_MAXIMUM = -1
      LP_RELEASE_STATUSES = New, Confirmed, Triaged, In Progress, Incomplete
    recipients: 'devops+alert@mirantis.com'
    repository: 'ssh://custom-scripts-ci@review.fuel-infra.org:29418/tools/custom-scripts'
    script_path: 'lp_release_migrator/lp_release_migrator.py'
    trigger: ''
    volumes: '-v /etc/custom_scripts/lp_release_migrator.conf:/etc/custom_scripts/lp_release_migrator.conf -v /etc/custom_scripts/lp_release_migrator_credentials.conf:/etc/custom_scripts/lp_release_migrator_credentials.conf -v /home/jenkins/.ssh/known_hosts:/root/.ssh/known_hosts'

    jobs:
      - '{name}'

- project:
    name: 'lp_milestone_status_changer'
    credentials: '87e8f7c8-9d04-4ffa-bd9c-9ef88acffec0'
    days: 1
    description: 'The job to run the script to differentiate fixed and none fixed bugs.'
    docker_image: 'python-jenkins-14-04'
    label_server: 'custom-scripts'
    mode: '--execute'
    num: 100
    properties: |
      LP_STATUS_CHANGER_PROJECTS = fuel, mos
      LP_STATUS_CHANGER_MILESTONES = 7.0,
      LP_STATUS_CHANGER_TRIGGER_STATUSES = Fix Committed, Fix Released
      LP_STATUS_CHANGER_STATUS_FROM = Confirmed
      LP_STATUS_CHANGER_STATUS_TO = Triaged
      LP_STATUS_CHANGER_MAXIMUM = -1
    recipients: 'devops+alert@mirantis.com'
    repository: 'ssh://custom-scripts-ci@review.fuel-infra.org:29418/tools/custom-scripts'
    script_path: 'lp-milestone-status-changer/lp_milestone_status_changer.py'
    trigger: ''
    volumes: '-v /etc/custom_scripts/lp_milestone_status_changer.conf:/etc/custom_scripts/lp_milestone_status_changer.conf -v /etc/custom_scripts/lp_milestone_status_changer_credentials.conf:/etc/custom_scripts/lp_milestone_status_changer_credentials.conf -v /home/jenkins/.ssh/known_hosts:/root/.ssh/known_hosts'

    jobs:
      - '{name}'
