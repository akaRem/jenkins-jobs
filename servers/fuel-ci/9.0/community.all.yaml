- job:
    name: '9.0-community.all'
    builders:
      - inject: # Defaults
          properties-content: |
            ISO_ID=community-9.0
            UBUNTU_MIRROR_ID=latest
            CENTOS_MIRROR_ID=latest
            MOS_CENTOS_ROOT=/mos-repos/centos/mos-master-centos7/
            MOS_UBUNTU_TARGET=master.target.txt
            MOS_UBUNTU_ROOT=/mos-repos/ubuntu/
            MIRROR_MOS_UBUNTU_SUITE=mos-master
      - shell:
          !include-raw builders/community.all.sh
    concurrent: true
    description:
      !include-raw descriptions/community.all
    logrotate:
      artifactDaysToKeep: 10
      artifactNumToKeep: 10
      daysToKeep: 10
      numToKeep: 10
    node: build
    properties:
      - build-timestamp
      - heavy-job:
          weight: 2
      - throttle:
          categories:
            - iso_builds
          max-per-node: 1
          option: category
    publishers:
      - archive:
          allow-empty: true
          artifacts: artifacts/*txt, artifacts/*changelog
          latest-only: false
      - email:
          notify-every-unstable-build: false
          recipients: ci+alert@mirantis.com
          send-to-individuals: false
      - naginator:
          max-failed-builds: 1
          rerun-unstable-builds: false
          fixed-delay: 60
      - trigger-parameterized-builds:
        - project: 9.0.publish_fuel_community_iso
          condition: UNSTABLE_OR_BETTER
          node-parameters: true
          predefined-parameters: |
            ISO_ID=9.0-$BUILD_NUMBER-$BUILD_TIMESTAMP
            ARTIFACTS_DIR=$WORKSPACE/artifacts
            BUILD=fuel-community-9.0-$BUILD_NUMBER-$BUILD_TIMESTAMP
        - project: fuel_community_build_reports
          condition: UNSTABLE_OR_BETTER
          predefined-parameters: |
            RELEASE=9.0
            BUILD=fuel-community-9.0-$BUILD_NUMBER-$BUILD_TIMESTAMP
            STAGE=build
            VALUE=ok
            REPORTED_JOB_URL=$BUILD_URL
        - project: fuel_community_build_reports
          condition: FAILED
          predefined-parameters: |
            RELEASE=9.0
            BUILD=fuel-community-9.0-$BUILD_NUMBER-$BUILD_TIMESTAMP
            STAGE=build
            VALUE=fail
            REPORTED_JOB_URL=$BUILD_URL
    scm:
      - git:
          url: 'https://git.openstack.org/openstack/fuel-main.git'
          branches:
            - 'origin/master'
    triggers:
      - timed: 'H */6 * * *'
    wrappers:
      - ansicolor:
          colormap: xterm
      - timeout:
          timeout: 120
          fail: true
