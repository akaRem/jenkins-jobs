- job:
    name: mcp.virtual.tempest.test
    project-type: freestyle
    defaults: global
    disabled: false
    concurrent: false
    retry-count: 2
    logrotate:
      daysToKeep: 7
      numToKeep: 9
      artifactDaysToKeep: 7
      artifactNumToKeep: 9
    properties:
    - heavy-job:
        weight: 4
    scm:
      - mirantis:
          reponame: 'tcp-qa'
          repobranch: 'origin/master'
          basedir: ''
    parameters:
      - mcp.virtual.tempest-params
      - string:
          name: LAB_CONFIG_NAME
      - string:
          name: ENV_NAME
      - string:
          name: REPORT_PREFIX
    builders:
      - shell:
          !include-raw: 'builders/mcp.virtual.tempest.sh'
    publishers:
      - archive:
          artifacts: 'log.log'
          allow-empty: 'true'
          fingerprint: true
      - archive:
          artifacts: 'verification.xml'
          allow-empty: 'true'
          fingerprint: true
      - junit:
          results: verification.xml
      - email:
          recipients: vjigulin@mirantis.com

- job-template:
    name: mcp11.virtual.tempest.{lab-config-name}
    project-type: freestyle
    defaults: global
    disabled: false
    concurrent: false
    retry-count: 2
    logrotate:
      daysToKeep: 5
      numToKeep: 21
      artifactDaysToKeep: 5
      artifactNumToKeep: 21
    properties:
      - heavy-job:
          weight: 4
    parameters:
      - mcp.virtual.tempest-params
    builders:
      - trigger-builds:
        - project: 'mcp.virtual.tempest.test'
          same-node: true
          block: true
          current-parameters: true
          predefined-parameters: |
            ENV_NAME=mcp.{lab-config-name}.$BUILD_ID
            LAB_CONFIG_NAME={lab-config-name}
            REPORT_PREFIX=$WORKSPACE/
      - trigger-builds:
        - project: 'maintenance-tempest-reports-Testrail'
          same-node: true
          block: true
          block-thresholds:
            build-step-failure-threshold: 'never'
          predefined-parameters: |
            NODE_LABELS=$NODE_LABELS
            REPORT_FILE=$WORKSPACE/verification.xml
            TESTRAIL_PLAN_NAME=$TESTRAIL_PLAN_NAME
            TEST_BUILD_URL=$BUILD_URL
            TESTRAIL_SUITE=Tempest 15.0.0
            MILESTONE=MCP1.1
            SPECIFICATION={lab-config-name}
            TESTRAIL_PROJECT=Mirantis Cloud Platform
            ADD_TIMESTAMP=false
            USE_TEMPLATE=true
            SEND_SKIPPED=true

- project:
    name: mcp11.virtual.tempest
    jobs:
      - 'mcp11.virtual.tempest.{lab-config-name}':
          lab-config-name: virtual-mcp11-ovs
      - 'mcp11.virtual.tempest.{lab-config-name}':
          lab-config-name: virtual-mcp11-dpdk
      - 'mcp11.virtual.tempest.{lab-config-name}':
          lab-config-name: virtual-mcp11-dvr
