- job-template:
    name: 'update-jenkins-jobs'
    description: |
      <p>Update jenkins jobs configuration on fuel-infra/jenkins-jobs merge or manually</p>
      <p>Requires python-tox package and user credentials stored as JJB_USER and JJB_PASS using Jenkins Global Passwords feature</p>
    concurrent: false
    node: 'jjb_update'
    builders:
      - inject:
          properties-content: 'CI_NAME={ci-name}'
      - shell:
          !include-raw-escape scripts/update-jenkins-jobs.sh
    parameters:
      - string:
          name: JOBS_LIST
          description: 'Space separated list of jobs to update. Will update all jobs if empty'
    publishers:
      - post-tasks:
        - matches:
          - log-text: '.'
          escalate-status: true
          script: !include-raw-escape scripts/update-jenkins-jobs-cleanup.sh
    scm:
      - git:
          branches:
            - master
          remotes:
            - gerrit:
                url: 'https://review.fuel-infra.org/fuel-infra/jenkins-jobs.git'
          choosing-strategy: default
    triggers:
      - gerrit:
          trigger-on:
            - change-merged-event
          projects:
            - project-compare-type: PLAIN
              project-pattern: 'fuel-infra/jenkins-jobs'
              branches:
                - branch-compare-type: PLAIN
                  branch-pattern: 'master'
              file-paths:
                - compare-type: ANT
                  pattern: 'common/**'
                - compare-type: ANT
                  pattern: 'servers/{ci-name}/**'
    wrappers:
      - timestamps
      - inject-passwords:
          global: true
